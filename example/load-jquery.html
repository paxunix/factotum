<!DOCTYPE html>   <!-- We're HTML5 -->

<html>

<head>

<title>Load jQuery</title>

<meta charset="UTF-8">  <!-- no lang by default -->

<!-- Here we (ab)use meta tags to supply metadata for this Fcommand. -->

<!-- Author's name and or email.  Required. -->
<meta name="author" content="paxunix@gmail.com">

<!-- Description of what this Fcommand does.  Required. -->
<meta name="description" content="Loads jQuery into the current page">

<!-- The string from navigator.language is used to find the most
appropriate tags when looking up localizable string content to be presented
to the user.  -->
<meta name="description" lang="fr" content="Faire la chose en franÃ§ais">

<!-- Unique identifier for this Fcommand.  Looks like a guid, and is treated
     as though it is unique across all Fcommands.  Required. -->
<meta name="guid" content="21eddb42-7c5b-4437-8b7a-f08df5ef3479">

<!-- Command names used to invoke this Fcommand.  Required. -->
<meta name="keywords" content="jq,loadjq">

<!-- URL from which to download this Fcommand.  Optional. -->
<meta name="downloadURL" content="http://example.com/load-jquery.html">

<!-- URL to check for a new version of this Fcommand.  Can return a document
     with only the <head><meta name="version"></head> markup.  Optional. -->
<meta name="updateURL" content="http://example.com/load-jquery.html">

<!-- Version of this Fcommand.  Required; validated against
     semantic versionning:  http://semver.org/ -->
<meta name="version" content="1.2.3">

<!-- Context in which the Fcommand's javascript is run.  If "bg", the code
is evaluated within the background page and thus has no access to the page's
DOM or javascript.  This is intended for Fcommands that only need to access
to chrome.* APIs and nothing else.  All other values equate to evaluating
the code within the page and has access to page's JS and DOM.  It can
postMessage() to the content script, which will pass the posted data to the
Fcommand's "bg-code" template script which will be run in the background
page.
-->
<meta name="context" content="page">

<!-- Specify the favicon for this Fcommand.  Optional.  -->
<link rel="icon" type="image/png" href="http://example.com/favicon.png">

<!-- Any scripts to be imported into the page on which the command is
invoked. -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

<!--
This block is the opts={} declaration for the minimist options parser.  It
must be a <template> with id=minimist-opt.

This is extracted by id in the bg script and passed to the minimist options
parser; then the hash returned by minimist is sent to the fcommand function
below.
-->

<template id="minimist-opt">
<!--
  You can have regular HTML comments in here.
  Everything else is presumed to be a single JSON blob.
  See https://github.com/substack/minimist for the spec.
-->
{
  "default": { "version": "latest" },
  "boolean": [ "min" ],
  "string": [ "version" ]
}
</template>

</head>

<body>

<!-- The help for this Fcommand is inside a <template>.  A popup window will
     be shown by the background script when the Fcommand is invoked with
     -help.

     There can be any content in here that you wish.  Factotum loads its own
     styling for the help document and also adds a centered OK button at the
     bottom, as well as capturing the Esc keypress to close the window.
     -->
<template id="help" lang="en">
This is the content shown when help is requested for this Fcommand.  It must
be in a &lt;template&gt; tag, have an id of "help" and can be anywhere in
the document.
<p>
I'm going to write all mine like man pages because that's how I roll.  Maybe
I'll default the styling to make man pages look awesome. (man7.org)
<pre>
loadjq [--min] [--version version]
</pre>
<p>
Defaults to loading the latest version.
<p>
</template>

<template id="fcommand">
<!-- Wrapping it in a script tag is optional; doing so only matters to your
editor's syntax highlighting. -->
<!-- This block contains the code that is executed within the context
specified in the metadata.  If you wrap it in a function{} block, you have to invoke the function and pass whatever is in arguments to it.
arguments contains a single object:
  {
    cmdline: minimist-opts parsed commandline for the command
    importDocument: the import document element
    responseCallback: function to call when your Fcommand has finished.  DO NOT FORGET THIS.  If you wish followup code to be executed in the background page context (e.g. you need to call a chrome.* API, say, to open a new tab, you can pass an array of the function object and any arguments it needs).
  }
-->
<script>
function bgcode (version)
{
    chrome.notifications.create(
        "",
        {
            type: "basic",
            iconUrl: chrome.runtime.getURL("icons/md/info.png"),
            title: "Loaded jQuery",
            message: "Version " + version,
        },
        function() {}
    );
}

console.log("Fcommand running with args: ", arguments);
arguments[0].responseCallback([bgcode, 12]);
</script>
</template>

<script>
console.log("This ran on import", window);
</script>

</body>
</html>

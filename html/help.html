<!DOCTYPE html>

<head>
  <link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
  <link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">
  <link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">

  <style is="custom-style" include="iron-flex iron-positioning"></style>
  <style is="custom-style">
    #help-content {
      padding-left: 72px;  /* XXX: can be determined dynamically based on toolbar padding? */
      padding-right: 72px;
    }
  </style>
</head>

<body class="fullbleed layout vertical">
  <paper-header-panel mode="standard">
    <paper-toolbar>
      <div class="title">Factotum Command Help: <span id="fcommandName"></span></div>
    </paper-toolbar>
    <div id="help-content" class="fit">
    </div>
  </paper-header-panel>

  <script>
    // Put help markup for this Fcommand into the dialog
    chrome.runtime.getBackgroundPage(function (bgScope) {
      // Extract Fcommand guid from "?guid=abcd" query string and use it to
      // get the help markup for the Fcommand.
      var guid = document.location.search.substr(6);

      bgScope.fcommandManager.getByGuid(guid)
        .then(function (fcommand) {
            document.querySelector("#help-content").innerHTML =
                fcommand.extractedData.helpMarkup;

            // XXX: it would be handy to use the same keyword that
            // activated the help, rather than always using the first
            // keyword for the Fcommand
            let title = `Factotum Command Help: ${fcommand.extractedData.keywords[0]}`;
            document.title = title;
            document.querySelector("#fcommandName").innerText =
                fcommand.extractedData.keywords[0];
          })
        .catch(function (rej) {
            // XXX: surface error to user
            console.error("Failed retrieving Fcommand: ", rej);
          });
    });
  </script>
</body>

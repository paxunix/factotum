<head>
  <link rel="import" href="../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
  <link rel="import" href="../bower_components/paper-material/paper-material.html">
  <link rel="import" href="../bower_components/paper-button/paper-button.html">

  <style>
    #help-material {
      padding: 1em;
    }
  </style>
</head>

<body unresolved>
  <paper-material id="help-material" elevation="3">
    <div id="help-content">
    </div>
    <div class="horizontal layout center-justified">
      <paper-button id="dismiss-button" raised autofocus>
        Dismiss
      </paper-button>
    </div>
  </paper-material>

  <script>
    var dismissBtn = document.querySelector("#dismiss-button");
    dismissBtn.addEventListener("click", function () {
      window.close();
    });

    // Put help markup for this Fcommand into the dialog
    chrome.runtime.getBackgroundPage(function (bgScope) {
      // Extract Fcommand guid from "?guid=abcd" query string and use it to
      // get the help markup for the Fcommand.
      var guid = document.location.search.substr(6);

      bgScope.fcommandManager.getByGuid(guid)
        .then(function (fcommand) {
            var container = document.querySelector("#help-content");
            Polymer.dom(container).innerHTML = fcommand.extractedData.helpMarkup;

            // XXX: it would be handy to use the same keyword that
            // activated the help, rather than always using the first
            // keyword for the Fcommand
            document.title = "Help: " + fcommand.extractedData.keywords[0];
          })
        .catch(function (rej) {
            // XXX: surface error to user
            console.error("Failed retrieving Fcommand: ", rej);
          });
    });
  </script>
</body>

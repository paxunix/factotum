<!DOCTYPE html>

<head>
  <link rel="import" href="../bower_components/polymer/polymer.html">
  <link rel="import" href="../bower_components/iron-icons/iron-icons.html">
  <link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
  <link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
  <link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
  <link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
  <link rel="import" href="factotum-shared-styles.html">
  <script type="text/javascript" src="../node_modules/webextension-polyfill/dist/browser-polyfill.min.js"></script>
</head>

<dom-module id="factotum-error">

<template>
  <style include="factotum-shared-styles">
  #errorList {
      width: 100%;
  }
  </style>

  <app-header-layout fullbleed>
    <app-header slot="header" fixed>
      <app-toolbar>
        <div main-title>Factotum Errors</div>
        <paper-icon-button id="deleteErrors" icon="icons:delete" on-click="deleteAction"></paper-icon-button>
      </app-toolbar>
    </app-header>

    <table id="errorList">
      <template is="dom-repeat" items="[[errorList]]">
        <tr class="stripeRow">
          <td>
            <pre>[[item.stack]]</pre>
          </td>
        </tr>
      </template>
    </table>

  </app-header-layout>
</template>

<script type="text/javascript" src="../node_modules/webextension-polyfill/dist/browser-polyfill.min.js"></script>
<script>
"use strict";

class ErrorsElement extends Polymer.Element
{
    static get is()
    {
        return "factotum-error";
    }


    static get properties()
    {
        return {
            errorList: {
                type: Array,
                value: () => [],
            },
            deleteActionEnabled: {
                type: Boolean,
                observer: "_deleteActionEnabled",
            }
        };
    }


    _deleteActionEnabled(newValue, oldValue)
    {
        this.$.deleteErrors.disabled = !newValue;
    }


    ready()
    {
        super.ready();

        browser.runtime.getBackgroundPage()
            .then(bgScope => {
                let errorManager = bgScope.g_fcommandManager.getErrorManager();
                this.deleteActionEnabled = errorManager.length() != 0;

                for (let err of errorManager)
                {
                    this.push("errorList", err);
                }
            });
      }


    deleteAction()
    {
        browser.runtime.getBackgroundPage()
            .then(bgScope => {
                let errorManager = bgScope.g_fcommandManager.getErrorManager();

                errorManager.clear();
            });
    }
}

customElements.define(ErrorsElement.is, ErrorsElement);
</script>

</dom-module>

<!DOCTYPE html>

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../bower_components/paper-styles/color.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">

<dom-module id="factotum-popup">

<template>
<style>
  paper-icon-item {
    --paper-item-icon-width: 34px;
    cursor: pointer;
  }

  paper-icon-item:hover {
    background-color: #d8d8d8;
  }

  #loadUrl {
    margin-top: 13px;
  }

  #quick-add input {
    font-size: 13px;
    min-width: 15em;
    transition-property: min-width;
    transition-duration: 0.2s;
  }

  #quick-add input:focus {
    min-width: 23em;
  }

  .error {
    color: red;
  }

  .success {
    color: green;
  }

</style>

<div id="list">
  <paper-icon-item>
    <!--
    XXX: show and then fade out one of these icons when the Fcommand is saved successfully, or there is a problem.
    <iron-icon class="error" icon="icons:error" item-icon></iron-icon>
    <iron-icon class="success" icon="icons:check-circle" item-icon></iron-icon>
    -->
    <paper-input id="quick-add" label="Quick Add" placeholder="Fcommand URL" value="{{fcommandUrl}}"></paper-input>
    <paper-icon-button id="loadUrl" icon="save" on-click="saveAction"></paper-icon-button>
  </paper-icon-item>
  <paper-listbox>
    <paper-icon-item id="menu-settings" disabled>
      <iron-icon icon="icons:settings-applications" item-icon></iron-icon>
      Settings
    </paper-icon-item>
    <paper-icon-item id="menu-errors" on-click="clickErrors">
      <iron-icon icon="icons:error" item-icon></iron-icon>
      Errors
    </paper-icon-item>
    <paper-icon-item id="menu-help" disabled>
      <iron-icon icon="icons:help" item-icon></iron-icon>
      Help
    </paper-icon-item>
  </paper-listbox>
</div>
</template>

<script>
"use strict";

Polymer({
    is: "factotum-popup",

    properties: {
        fcommandUrl: {
            type: String,
            value: "",
        }
    },

    saveAction: function () {
        let url = this.fcommandUrl.trim();

        if (url === "")
            return;

        chrome.runtime.getBackgroundPage(bgScope => {
            // XXX:  this can fail, and we should alert the user somehow
            bgScope.g_fcommandManager.fetchFcommandUrl(url)
              .then(() => {
                  // Clear the URL entry control
                  // XXX: should have some visual indication of success (like backround of control fades from green to default)
                  this.fcommandUrl = "";
              }).catch(() => {
                  // XXX: should have some visual indication of failure (like backround of control fades from red to default)
              });
        })
    },

    clickErrors: function () {
        chrome.runtime.getBackgroundPage(bgScope => {
            bgScope.g_fcommandManager.getErrorManager()._openErrorPage();
        });
    },
});
</script>

</dom-module>

<!DOCTYPE html>

<head>
  <link rel="import" href="../bower_components/polymer/polymer.html">
  <link rel="import" href="../bower_components/iron-icons/iron-icons.html">
  <link rel="import" href="../bower_components/paper-item/paper-icon-item.html">
  <link rel="import" href="../bower_components/paper-styles/color.html">
  <link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
  <link rel="import" href="../bower_components/paper-input/paper-input.html">
  <link rel="import" href="factotum-shared-styles.html">
</head>

<dom-module id="factotum-popup">

<template>

<style include="factotum-shared-styles">
  paper-icon-item {
    cursor: pointer;
  }

  paper-icon-item:hover {
    background: var(--light-secondary-color);
  }

  #quick-add {
    --paper-input-container-input-color: var(--secondary-text-color);
    width: 12em;
    transition-property: width;
    transition-duration: 0.3s;
  }

  #quick-add[focused] {
      width: 40em;
  }

  #loadUrl {
      margin-top: 2ex;
  }

  .error {
    color: red;
  }

  .success {
    color: green;
  }

</style>

<div id="menu">
    <paper-icon-item>
      <!--
      XXX: show and then fade out one of these icons when the Fcommand is saved successfully, or there is a problem.
      <iron-icon class="error" icon="icons:error" item-icon></iron-icon>
      <iron-icon class="success" icon="icons:check-circle" item-icon></iron-icon>
      -->
      <paper-input id="quick-add" label="Quick Add" placeholder="Fcommand URL" value="{{fcommandUrl}}"></paper-input>
      <paper-icon-button id="loadUrl" icon="save" on-click="saveAction"></paper-icon-button>
    </paper-icon-item>
    <paper-icon-item id="menu-fcommands" on-click="clickFcommands">
      <iron-icon icon="apps" slot="item-icon"></iron-icon>
      Fcommands
    </paper-icon-item>
    <paper-icon-item id="menu-settings" disabled>
      <iron-icon icon="settings-applications" slot="item-icon"></iron-icon>
      Settings
    </paper-icon-item>
    <paper-icon-item id="menu-errors" on-click="clickErrors">
      <iron-icon icon="error" slot="item-icon"></iron-icon>
      Errors
    </paper-icon-item>
    <paper-icon-item id="menu-help" disabled>
      <iron-icon icon="help" slot="item-icon"></iron-icon>
      Help
    </paper-icon-item>
</div>
</template>

<script>
"use strict";

class PopupElement extends Polymer.Element
{
    static get is()
    {
        return "factotum-popup";
    }


    static get properties()
    {
        return {
            fcommandUrl: {
                type: String,
                value: "",
            }
        };
    }


    saveAction()
    {
        let url = this.fcommandUrl.trim();

        if (url === "")
            return;

        chrome.runtime.getBackgroundPage(bgScope => {
            // XXX:  this can fail, and we should alert the user somehow
            bgScope.g_fcommandManager.fetchFcommandUrl(url)
              .then(() => {
                  // Clear the URL entry control
                  // XXX: should have some visual indication of success (like backround of control fades from green to default)
                  this.fcommandUrl = "";
              }).catch(() => {
                  // XXX: should have some visual indication of failure (like backround of control fades from red to default)
              });
        })
    }


    clickFcommands()
    {
        chrome.runtime.getBackgroundPage(bgScope => {
            bgScope.g_fcommandManager.openFcommandsPage();
        });
    }


    clickErrors()
    {
        chrome.runtime.getBackgroundPage(bgScope => {
            bgScope.g_fcommandManager.getErrorManager()._openErrorPage();
        });
    }


    ready()
    {
        super.ready();
    }
}

customElements.define(PopupElement.is, PopupElement);
</script>

</dom-module>
